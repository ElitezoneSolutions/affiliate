(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{2373:function(e,s,t){Promise.resolve().then(t.bind(t,7525))},7525:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var a=t(7437),l=t(2265),r=t(4873),n=t(9376),i=t(2141),d=t(2869),c=t(5186),o=t(6070),x=t(5974),u=t(5613),m=t(2252),h=t(5805),f=t(8736),p=t(5252),j=t(740),y=t(3247),g=t(2208),v=t(7648),N=t(872);function b(){let{user:e,signOut:s}=(0,r.a)(),t=(0,n.useRouter)(),[b,_]=(0,l.useState)(!0),[w,Z]=(0,l.useState)(""),[k,E]=(0,l.useState)([]),[C,O]=(0,l.useState)([]),[A,S]=(0,l.useState)({search:"",role:"all",hasEarnings:"all"});(0,l.useEffect)(()=>{if(!e){t.replace("/login");return}if(!e.is_admin){t.replace("/dashboard");return}q()},[e,t]),(0,l.useEffect)(()=>{let e=k;if(A.search){let s=A.search.toLowerCase();e=e.filter(e=>{var t,a;return(null===(t=e.first_name)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(a=e.last_name)||void 0===a?void 0:a.toLowerCase().includes(s))||e.email.toLowerCase().includes(s)})}"all"!==A.role&&(e=e.filter(e=>"admin"===A.role?e.is_admin:!e.is_admin)),"all"!==A.hasEarnings&&(e=e.filter(e=>"yes"===A.hasEarnings?e.total_earnings>0:0===e.total_earnings)),O(e)},[k,A]);let q=async()=>{try{_(!0),Z("");let{data:e,error:s}=await i.O.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;let t=await Promise.all((e||[]).map(async e=>{var s;let{data:t}=await i.O.from("leads").select("status, price, paid, created_at").eq("affiliate_id",e.id).order("created_at",{ascending:!1}),{data:a}=await i.O.from("payout_requests").select("id").eq("affiliate_id",e.id),l=(null==t?void 0:t.length)||0,r=(null==t?void 0:t.filter(e=>"approved"===e.status).length)||0,n=(null==t?void 0:t.filter(e=>"pending"===e.status).length)||0,d=(null==t?void 0:t.filter(e=>"rejected"===e.status).length)||0,c=(null==t?void 0:t.filter(e=>"approved"===e.status).reduce((e,s)=>e+(s.price||0),0))||0,o=(null==t?void 0:t.filter(e=>"approved"===e.status&&e.paid).reduce((e,s)=>e+(s.price||0),0))||0,x=null==t?void 0:null===(s=t[0])||void 0===s?void 0:s.created_at;return{...e,total_leads:l,approved_leads:r,pending_leads:n,rejected_leads:d,total_earnings:c,unpaid_earnings:c-o,paid_earnings:o,payout_requests:(null==a?void 0:a.length)||0,last_lead_date:x}}));E(t)}catch(e){Z(e.message)}finally{_(!1)}},L=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return b?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):(0,a.jsx)(N.l,{children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage all users and view their performance"})]}),w&&(0,a.jsxs)(u.bZ,{variant:"destructive",className:"mb-6",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4"}),(0,a.jsx)(u.X,{children:w})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.ll,{className:"text-sm font-medium",children:"Total Users"}),(0,a.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:k.length}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[k.filter(e=>!e.is_admin).length," affiliates"]})]})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.ll,{className:"text-sm font-medium",children:"Active Users"}),(0,a.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:k.filter(e=>e.total_leads>0).length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"With submitted leads"})]})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.ll,{className:"text-sm font-medium",children:"Total Earnings"}),(0,a.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.aY,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",k.reduce((e,s)=>e+s.total_earnings,0)]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["$",k.reduce((e,s)=>e+s.unpaid_earnings,0)," unpaid"]})]})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.ll,{className:"text-sm font-medium",children:"Avg Earnings"}),(0,a.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.aY,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",k.length>0?Math.round(k.reduce((e,s)=>e+s.total_earnings,0)/k.length):0]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user"})]})]})]}),(0,a.jsxs)(o.Zb,{className:"mb-6",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"h-5 w-5"}),"Filters"]})}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Search Users"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,a.jsx)(c.I,{placeholder:"Search by name or email...",value:A.search,onChange:e=>S(s=>({...s,search:e.target.value})),className:"pl-10"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Role"}),(0,a.jsxs)("select",{value:A.role,onChange:e=>S(s=>({...s,role:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"all",children:"All Users"}),(0,a.jsx)("option",{value:"admin",children:"Admins Only"}),(0,a.jsx)("option",{value:"user",children:"Affiliates Only"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Earnings"}),(0,a.jsxs)("select",{value:A.hasEarnings,onChange:e=>S(s=>({...s,hasEarnings:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"all",children:"All Users"}),(0,a.jsx)("option",{value:"yes",children:"With Earnings"}),(0,a.jsx)("option",{value:"no",children:"No Earnings"})]})]})]})})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsxs)(o.ll,{children:["All Users (",C.length,")"]}),(0,a.jsx)(o.SZ,{children:"Detailed view of all users and their performance metrics"})]}),(0,a.jsx)(o.aY,{children:0===C.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(h.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No users found matching your filters"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"User"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Role"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Leads"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Earnings"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Payouts"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Joined"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Last Activity"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:C.map(e=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.email})]})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)(x.C,{variant:e.is_admin?"default":"secondary",children:e.is_admin?"Admin":"Affiliate"})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{children:["Total: ",e.total_leads]}),(0,a.jsxs)("div",{className:"text-green-600",children:["✓ ",e.approved_leads]}),(0,a.jsxs)("div",{className:"text-yellow-600",children:["⏳ ",e.pending_leads]}),(0,a.jsxs)("div",{className:"text-red-600",children:["✗ ",e.rejected_leads]})]})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium",children:["$",e.total_earnings]}),(0,a.jsxs)("div",{className:"text-green-600",children:["Paid: $",e.paid_earnings]}),(0,a.jsxs)("div",{className:"text-orange-600",children:["Unpaid: $",e.unpaid_earnings]})]})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"text-sm",children:[e.payout_requests," requests"]})}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm",children:L(e.created_at)}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm",children:e.last_lead_date?L(e.last_lead_date):"Never"}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(v.default,{href:"/admin/users/".concat(e.id),children:(0,a.jsxs)(d.z,{variant:"outline",size:"sm",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),"View"]})}),(0,a.jsx)(v.default,{href:"/admin/users/".concat(e.id,"/leads"),children:(0,a.jsxs)(d.z,{variant:"outline",size:"sm",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),"Leads"]})})]})})]},e.id))})]})})})]})]})})})}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var a=t(7437);t(2265);var l=t(535),r=t(4508);let n=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...l}=e;return(0,a.jsx)("div",{className:(0,r.cn)(n({variant:t}),s),...l})}},5186:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var a=t(7437),l=t(2265),r=t(4508);let n=l.forwardRef((e,s)=>{let{className:t,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},2252:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8226:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},5252:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2208:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},740:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},5466:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},7692:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},3247:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},function(e){e.O(0,[580,697,648,13,971,117,744],function(){return e(e.s=2373)}),_N_E=e.O()}]);