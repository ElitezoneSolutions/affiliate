(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{7688:function(e,s,t){Promise.resolve().then(t.bind(t,4249))},4249:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var r=t(7437),a=t(2265),l=t(4873),i=t(9376),n=t(2141),d=t(2869),c=t(6070),o=t(5974),u=t(5613),x=t(6818),m=t(5302),h=t(5131),f=t(1723),p=t(2252),y=t(8226),j=t(5252),g=t(740),v=t(3247),b=t(872);function N(){let{user:e,signOut:s}=(0,l.a)(),t=(0,i.useRouter)(),[N,w]=(0,a.useState)(!0),[k,Z]=(0,a.useState)(""),[q,_]=(0,a.useState)([]),[C,P]=(0,a.useState)([]),[S,O]=(0,a.useState)(null),[A,L]=(0,a.useState)(""),[R,z]=(0,a.useState)({status:"all",method:"all",search:""});(0,a.useEffect)(()=>{if(!e){t.replace("/login");return}if(!e.is_admin){t.replace("/dashboard");return}M()},[e,t]),(0,a.useEffect)(()=>{let e=q;if("all"!==R.status&&(e=e.filter(e=>e.status===R.status)),"all"!==R.method&&(e=e.filter(e=>e.method===R.method)),R.search){let s=R.search.toLowerCase();e=e.filter(e=>{var t,r;return(null===(t=e.user.first_name)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(r=e.user.last_name)||void 0===r?void 0:r.toLowerCase().includes(s))||e.user.email.toLowerCase().includes(s)})}P(e)},[q,R]);let M=async()=>{try{w(!0),Z("");let{data:e,error:s}=await n.O.from("payout_requests").select("\n          *,\n          users!payout_requests_affiliate_id_fkey(email, first_name, last_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;let t=(e||[]).map(e=>({...e,user:e.users}));_(t)}catch(e){Z(e.message)}finally{w(!1)}},T=async(e,s)=>{try{O(e),Z("");let{error:t}=await n.O.from("payout_requests").update({status:s,note:A||void 0}).eq("id",e);if(t)throw t;if("approved"===s){let s=q.find(s=>s.id===e);if(s){let{data:e}=await n.O.from("leads").select("id, price").eq("affiliate_id",s.affiliate_id).eq("status","approved").eq("paid",!1);if(e&&e.length>0){let t=s.amount,r=[];for(let s of e)if(t>=(s.price||0))r.push(s.id),t-=s.price||0;else break;r.length>0&&await n.O.from("leads").update({paid:!0}).in("id",r)}}}_(t=>t.map(t=>t.id===e?{...t,status:s,note:A||void 0}:t)),O(null),L(""),console.log("Payout ".concat(s," successfully!"))}catch(e){Z(e.message),O(null)}},Y=e=>{switch(e){case"approved":return(0,r.jsx)(m.Z,{className:"h-4 w-4 text-green-600"});case"rejected":return(0,r.jsx)(h.Z,{className:"h-4 w-4 text-red-600"});default:return(0,r.jsx)(f.Z,{className:"h-4 w-4 text-yellow-600"})}},D=e=>{switch(e){case"approved":return(0,r.jsx)(o.C,{className:"bg-green-100 text-green-800",children:"Approved"});case"rejected":return(0,r.jsx)(o.C,{variant:"destructive",children:"Rejected"});default:return(0,r.jsx)(o.C,{variant:"secondary",children:"Pending"})}},E=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=e=>{switch(e){case"paypal":return"PayPal";case"wise":return"Wise";case"bank_transfer":return"Bank Transfer";default:return e}};return N?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):(0,r.jsx)(b.l,{children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Payout Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Process payout requests from affiliates"})]}),k&&(0,r.jsxs)(u.bZ,{variant:"destructive",className:"mb-6",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),(0,r.jsx)(u.X,{children:k})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(c.ll,{className:"text-sm font-medium",children:"Total Payouts"}),(0,r.jsx)(y.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(c.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:q.length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"All time requests"})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(c.ll,{className:"text-sm font-medium",children:"Pending"}),(0,r.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(c.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:q.filter(e=>"requested"===e.status).length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting processing"})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(c.ll,{className:"text-sm font-medium",children:"Total Amount"}),(0,r.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(c.aY,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["$",q.reduce((e,s)=>e+s.amount,0)]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"All requests"})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(c.ll,{className:"text-sm font-medium",children:"Pending Amount"}),(0,r.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(c.aY,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["$",q.filter(e=>"requested"===e.status).reduce((e,s)=>e+s.amount,0)]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"To be processed"})]})]})]}),(0,r.jsxs)(c.Zb,{className:"mb-6",children:[(0,r.jsx)(c.Ol,{children:(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{className:"h-5 w-5"}),"Filters"]})}),(0,r.jsx)(c.aY,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Search"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(v.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Search by user name or email...",value:R.search,onChange:e=>z(s=>({...s,search:e.target.value})),className:"w-full pl-10 p-2 border border-gray-300 rounded-md"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Status"}),(0,r.jsxs)("select",{value:R.status,onChange:e=>z(s=>({...s,status:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,r.jsx)("option",{value:"all",children:"All Status"}),(0,r.jsx)("option",{value:"requested",children:"Pending"}),(0,r.jsx)("option",{value:"approved",children:"Approved"}),(0,r.jsx)("option",{value:"rejected",children:"Rejected"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Method"}),(0,r.jsxs)("select",{value:R.method,onChange:e=>z(s=>({...s,method:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,r.jsx)("option",{value:"all",children:"All Methods"}),(0,r.jsx)("option",{value:"paypal",children:"PayPal"}),(0,r.jsx)("option",{value:"wise",children:"Wise"}),(0,r.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"})]})]})]})})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{children:["Payout Requests (",C.length,")"]}),(0,r.jsx)(c.SZ,{children:"Review and process payout requests from affiliates"})]}),(0,r.jsx)(c.aY,{children:0===C.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(y.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"No payout requests found"})]}):(0,r.jsx)("div",{className:"space-y-4",children:C.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[Y(e.status),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium",children:[e.user.first_name," ",e.user.last_name]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.user.email})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",e.amount]}),D(e.status)]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Method:"})," ",H(e.method)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Requested:"})," ",E(e.created_at)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Details:"})," ",JSON.stringify(e.details)]})]}),e.note&&(0,r.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-md",children:[(0,r.jsx)("div",{className:"font-medium text-sm",children:"Admin Note:"}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.note})]}),"requested"===e.status&&(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Processing Note (Optional)"}),(0,r.jsx)(x.g,{placeholder:"Add a note about this payout...",value:A,onChange:e=>L(e.target.value),className:"mt-1"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.z,{onClick:()=>T(e.id,"approved"),disabled:S===e.id,className:"bg-green-600 hover:bg-green-700",children:S===e.id?"Processing...":"Approve Payout"}),(0,r.jsx)(d.z,{onClick:()=>T(e.id,"rejected"),disabled:S===e.id,variant:"destructive",children:S===e.id?"Processing...":"Reject Payout"})]})]})]},e.id))})})]})]})})})}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return n}});var r=t(7437);t(2265);var a=t(535),l=t(4508);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)(i({variant:t}),s),...a})}},6818:function(e,s,t){"use strict";t.d(s,{g:function(){return i}});var r=t(7437),a=t(2265),l=t(4508);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...a})});i.displayName="Textarea"},2252:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5302:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1723:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8226:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},5252:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},740:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},5466:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},7692:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},3247:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},5131:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},function(e){e.O(0,[580,697,648,13,971,117,744],function(){return e(e.s=7688)}),_N_E=e.O()}]);